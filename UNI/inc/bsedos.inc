;/*!
;   @file
;
;   @ingroup fapi
;
;   @brief Family API implementation
;
;   (c) osFree Project 2018-2022, <http://www.osFree.org>
;   for licence see licence.txt in root directory, or project website
;
;   This is Family API implementation for DOS, used with BIND tools
;   to link required API
;
;   @author Yuri Prokushev (yuri.prokushev@gmail.com)
;
;*/

		INCLUDE	mac.inc

SEG_NONSHARED	EQU	0
SEG_GIVEABLE	EQU	1
SEG_GETTABLE	EQU	2
SEG_DISCARDABLE	EQU	4

COUNTRYCODE	struc
		country		DW	?
		codepage	DW	?
COUNTRYCODE	ends

@DosOpen	MACRO	NAME,HANDLE,ACTION,SIZE,ATTRIB,FLAG,MODE,RSRVD
		@DEFINE	DOSOPEN
		@PUSHS	NAME
		@PUSHS	HANDLE
		@PUSHS	ACTION
		@PUSHD	SIZE
		@PUSHW	ATTRIB
		@PUSHW	FLAG
		@PUSHW	MODE
		@PUSHD	RSRVD
		CALL	DOSOPEN
		ENDM

@DosClose	MACRO	HANDLE
		@DEFINE	DOSCLOSE
		@PUSHW	HANDLE
		CALL	DOSCLOSE
		ENDM

@DosGetInfoSeg	MACRO	GLOBAL,LOCAL
		@DEFINE	DOSGETINFOSEG
		@PUSHS	GLOBAL
		@PUSHS	LOCAL
		CALL	DOSGETINFOSEG
		ENDM

@DosLoadModule	MACRO	BUFFADDR,BUFFLEN,NAME,HANDLE
		@DEFINE	DOSLOADMODULE
		@PUSHD	BUFFADDR
		@PUSHW	BUFFLEN
		@PUSHS	NAME
		@PUSHS	HANDLE
		CALL	FAR PTR DOSLOADMODULE
		ENDM

@DosGetProcAddr	MACRO	HANDLE,NAME,ADDR
		@DEFINE	DOSGETPROCADDR
		@PUSHW	HANDLE
		@PUSHS	NAME
		@PUSHS	ADDR
		CALL	FAR PTR DOSGETPROCADDR
		ENDM

@DosFreeModule	MACRO	HANDLE
		@DEFINE	DOSFREEMODULE
		@PUSHW	HANDLE
		CALL	FAR PTR DOSFREEMODULE
		ENDM

IOCTL_ASYNC		EQU	0001H
IOCTL_SCR_AND_PTRDRAW	EQU	0003H
IOCTL_KEYBOARD		EQU	0004H
IOCTL_PRINTER		EQU	0005H
IOCTL_LIGHTPEN		EQU	0006H
IOCTL_POINTINGDEVICE	EQU	0007H
IOCTL_DISK		EQU	0008H
IOCTL_PHYSICALDISK	EQU	0009H
IOCTL_MONITOR		EQU	000AH
IOCTL_GENERAL		EQU	000BH
IOCTL_POWER		EQU	000CH
IOCTL_OEMHLP		EQU	0080H
IOCTL_TESTCFG_SYS	EQU	0080H
IOCTL_CDROMDISK		EQU	0080H
IOCTL_CDROMAUDIO	EQU	0081H
IOCTL_TOUCH_DEVDEP	EQU	0081H
IOCTL_TOUCH_DEVINDEP	EQU	0081H

ASYNC_SETBAUDRATE		EQU	0041H
ASYNC_SETLINECTRL		EQU	0042H
ASYNC_EXTSETBAUDRATE		EQU	0043H
ASYNC_TRANSMITIMM		EQU	0044H
ASYNC_SETBREAKOFF		EQU	0045H
ASYNC_SETMODEMCTRL		EQU	0046H
ASYNC_SETBREAKON		EQU	004BH
ASYNC_STOPTRANSMIT		EQU	0047H
ASYNC_STARTTRANSMIT		EQU	0048H
ASYNC_SETDCBINFO		EQU	0053H
ASYNC_SETENHANCEDMODEPARMS	EQU	0054H
ASYNC_GETBAUDRATE		EQU	0061H
ASYNC_GETLINECTRL		EQU	0062H
ASYNC_EXTGETBAUDRATE		EQU	0063H
ASYNC_GETCOMMSTATUS		EQU	0064H
ASYNC_GETLINESTATUS		EQU	0065H
ASYNC_GETMODEMOUTPUT		EQU	0066H
ASYNC_GETMODEMINPUT		EQU	0067H
ASYNC_GETINQUECOUNT		EQU	0068H
ASYNC_GETOUTQUECOUNT		EQU	0069H
ASYNC_GETCOMMERROR		EQU	006DH
ASYNC_GETCOMMEVENT		EQU	0072H
ASYNC_GETDCBINFO		EQU	0073H
ASYNC_GETENHANCEDMODEPARMS	EQU	0074H

SCR_ALLOCLDT		EQU	0070H
SCR_DEALLOCLDT		EQU	0071H
PTR_GETPTRDRAWADDRESS	EQU	0072H
VID_INITCALLVECTOR	EQU	0073H
SCR_ABIOSPASSTHRU	EQU	0074H
SCR_ALLOCLDTOFF		EQU	0075H
SCR_ALLOCLDTBGVAL	EQU	0076H
SCR_ALLOCVIDEOBUFFER	EQU	007EH
SCR_GETROMFONTADDR	EQU	007FH

KBD_SETTRANSTABLE		EQU	0050H
KBD_SETINPUTMODE		EQU	0051H
KBD_SETINTERIMFLAG		EQU	0052H
KBD_SETSHIFTSTATE		EQU	0053H
KBD_SETTYPAMATICRATE		EQU	0054H
KBD_SETFGNDSCREENGRP		EQU	0055H
KBD_SETSESMGRHOTKEY		EQU	0056H
KBD_SETFOCUS			EQU	0057H
KBD_SETKCB			EQU	0058H
KBD_SETREADNOTIFICATION		EQU	0059H
KBD_ALTERKBDLED			EQU	005AH
KBD_SETNLS			EQU	005CH
KBD_CREATE			EQU	005DH
KBD_DESTROY			EQU	005EH
KBD_GETINPUTMODE		EQU	0071H
KBD_GETINTERIMFLAG		EQU	0072H
KBD_GETSHIFTSTATE		EQU	0073H
KBD_READCHAR			EQU	0074H
KBD_PEEKCHAR			EQU	0075H
KBD_GETSESMGRHOTKEY		EQU	0076H
KBD_GETKEYBDTYPE		EQU	0077H
KBD_GETCODEPAGEID		EQU	0078H
KBD_XLATESCAN			EQU	0079H
KBD_QUERYKBDHARDWAREID		EQU	007AH
KBD_QUERYKBDCODEPAGESUPPORT	EQU	007BH

PRT_QUERYJOBHANDLE	EQU	0021H
PRT_SETFRAMECTL		EQU	0042H
PRT_SETINFINITERETRY	EQU	0044H
PRT_INITPRINTER		EQU	0046H
PRT_ACTIVATEFONT	EQU	0048H
PRT_SETPRINTJOBTITLE	EQU	004DH
PRT_SETIRQTIMEOUT	EQU	004EH
PRT_SETCOMMMODE		EQU	0052H
PRT_SETDATAXFERMODE	EQU	0053H
PRT_GETFRAMECTL		EQU	0062H
PRT_GETINFINITERETRY	EQU	0064H
PRT_GETPRINTERSTATUS	EQU	0066H
PRT_QUERYACTIVEFONT	EQU	0069H
PRT_VERIFYFONT		EQU	006AH
PRT_QUERYIRQTIMEOUT	EQU	006EH
PRT_QUERYCOMMMODE	EQU	0072H
PRT_QUERYDATAXFERMODE	EQU	0073H
PRT_QUERDEVICEID	EQU	0074H

; IOM constants from old OS/2 toolkit. Need to check for correct values. Draft.

MOU_ALLOWPTRDRAW		EQU	0050H
MOU_UPDATEDISPLAYMODE		EQU	0051H
MOU_SCREENSWITCH		EQU	0052H
MOU_SETSCALEFACTORS		EQU	0053H
IOMW_SS		EQU	53H
MOU_SETEVENTMASK		EQU	0054H
IOMW_EM		EQU	54H
MOU_SETHOTKEYBUTTON		EQU	0055H
MOU_REASSIGNTHRESHOLDVALUES	EQU	0055H
MOU_SETPTRSHAPE			EQU	0056H
IOMW_SP		EQU	56H
MOU_DRAWPTR			EQU	0057H
MOU_UNMARKCOLLISIONAREA		EQU	0057H
IOMW_DP		EQU	57H
MOU_REMOVEPTR			EQU	0058H
IOMW_RP		EQU	58H
MOU_MARKCOLLISIONAREA		EQU	0058H
MOU_SETPTRPOS			EQU	0059H
MOU_SETPROTDRAWADDRESS		EQU	005AH
MOU_SETREALDRAWADDRESS		EQU	005BH
MOU_SETMOUSTATUS		EQU	005CH
IOMW_DS		EQU	5CH
MOU_DISPLAYMODECHANGE		EQU	005DH
MOU_GETBUTTONCOUNT		EQU	0060H
IOMR_NB		EQU	60H
MOU_GETMICKEYCOUNT		EQU	0061H
IOMR_MC		EQU	61H
MOU_GETMOUSTATUS		EQU	0062H
IOMR_GS		EQU	62H
MOU_READEVENTQUE		EQU	0063H
IOMR_RD		EQU	63H
MOU_GETQUESTATUS		EQU	0064H
IOMR_QS		EQU	64H
MOU_GETEVENTMASK		EQU	0065H
IOMR_GM		EQU	65H
MOU_GETSCALEFACTORS		EQU	0066H
IOMR_GF		EQU	66H
MOU_GETPTRPOS			EQU	0067H
MOU_GETPTRSHAPE			EQU	0068H
IOMW_GP		EQU	68H
MOU_GETHOTKEYBUTTON		EQU	0069H
MOU_QUERYTHRESHOLDVALUES	EQU	0069H
MOU_VER				EQU	006AH
MOU_QUERYPOINTERID		EQU	006BH

DSK_LOCKDRIVE		EQU	0000H
DSK_UNLOCKDRIVE		EQU	0001H
DSK_REDETERMINEMEDIA	EQU	0002H
DSK_SETLOGICALMAP	EQU	0003H
DSK_BEGINFORMAT		EQU	0004H
DSK_BLOCKREMOVABLE	EQU	0020H
DSK_GETLOGICALMAP	EQU	0021H
DSK_UNLOCKEJECTMEDIA	EQU	0040H
DSK_SETDEVICEPARAMS	EQU	0043H
DSK_WRITETRACK		EQU	0044H
DSK_FORMATVERIFY	EQU	0045H
DSK_DISKETTECONTROL	EQU	005DH
DSK_QUERYMEDIASENSE	EQU	0060H
DSK_GETDEVICEPARAMS	EQU	0063H
DSK_READTRACK		EQU	0064H
DSK_VERIFYTRACK		EQU	0065H
DSK_GETLOCKSTATUS	EQU	0066H

PDSK_LOCKPHYSDRIVE		EQU	0000H
PDSK_UNLOCKPHYSDRIVE		EQU	0001H
PDSK_WRITEPHYSTRACK		EQU	0044H
PDSK_GETPHYSDEVICEPARAMS	EQU	0063H
PDSK_READPHYSTRACK		EQU	0064H
PDSK_VERIFYPHYSTRACK		EQU	0065H

MON_REGISTERMONITOR	EQU	0040H

DEV_FLUSHINPUT		EQU	0001H
DEV_FLUSHOUTPUT		EQU	0002H
DEV_SYSTEMNOTIFYPDD	EQU	0041H
DEV_QUERYMONSUPPORT	EQU	0060H

@DosDevIOCtl	MACRO	DATA,PARMS,FUNCTN,CATEGRY,DEVICE
		@DEFINE	DOSDEVIOCTL
		IFB <DATA>
			XOR	AX,AX
			PUSH	AX
			PUSH	AX
		ELSE
			@PUSHS	DATA
		ENDIF
		IFB <PARMS>
			XOR	AX,AX
			PUSH	AX
			PUSH	AX
		ELSE
			@PUSHS	PARMS
		ENDIF
		@PUSHW	FUNCTN
		@PUSHW	CATEGRY
		@PUSHW	DEVICE
		CALL	FAR PTR DOSDEVIOCTL
		ENDM

@DosDevIOCtl2	MACRO	DATA,DATALEN,PARM,PARMLEN,FUNCTN,CATEGRY,DEVICE
		@DEFINE	DOSDEVIOCTL2
		@PUSHS	DATA
		@PUSHW	DATALEN
		@PUSHS	PARM
		@PUSHW	PARMLEN
		@PUSHW	FUNCTN
		@PUSHW	CATEGRY
		@PUSHW	DEVICE
		CALL	FAR PTR DOSDEVIOCTL2
		ENDM
